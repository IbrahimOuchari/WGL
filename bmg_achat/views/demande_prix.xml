<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="purchase_rfq_tree_view" model="ir.ui.view">
        <field name="name">purchase.rfq.tree</field>
        <field name="model">purchase.rfq</field>
        <field name="arch" type="xml">

            <tree string="Demande de Prix">
                <field name="name" string="Référence"/>
                <field name="partner_id"/>
                <field name="company_id"/>
                <field name="date_rfq"/>
                <!--<field name="status_devis" widget="badge"
                       decoration-muted="status_devis == '1'"
                       decoration-success="status_devis == '2'"
                       decoration-danger="status_devis == '3'"
                       decoration-warning="status_devis == '4'"/>
                       -->
            </tree>
        </field>
    </record>

    <record id="purchase_rfq_form_view" model="ir.ui.view">
        <field name="name">purchase.rfq.form</field>
        <field name="model">purchase.rfq</field>
        <field name="arch" type="xml">
            <form string="Demande de Prix">
                <header>
                    <field name="state" widget="statusbar" nolabel="1"/>
                    <button name="create_order"
                            string="Créer Commande d'Achat" class="btn-primary" type="object"
                            attrs="{'invisible': [('state', 'not in', [('rfq')])]}"/>

                    <button name="action_cancel"
                            string="Annuler La Demande" class="btn-secondary" type="object"
                            attrs="{'invisible': [('state', 'not in', [('rfq'), ('confirme')])]}"/>

                </header>
                <sheet>
                    <div class="oe_title">

                        <h1>
                            <field name="priority" widget="priority" class="mr-3"/>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group name="rfq_header">
                        <group name="partner" options="{'no_open':True,'no_create': True}">
                            <field name="partner_id"/>
                        </group>

                        <group name="date">
                            <field name="date_rfq"/>
                            <field name="date_planned"/>
                        </group>

                        <group name="info_achat">
                            <field name="user_id"/>
                            <field name="company_id"/>
                        </group>

                    </group>
                    <notebook>
                        <page string="Lignes Demande de Prix" name="rfq_lines">
                            <field
                                    name="rfq_line"
                                    widget="section_and_note_one2many"
                                    mode="tree,kanban"
                                    attrs="{'readonly': [('state', 'in', 'cancel')]}">

                                <tree string="Rfq Ligne" editable="bottom">
                                    <control>
                                        <create name="add_product_control" string="Ajouter un Article"/>
                                        <create name="add_section_control" string="Ajouter une Section"
                                                context="{'default_display_type': 'line_section'}"/>
                                        <create name="add_note_control" string="Ajouter une Note"
                                                context="{'default_display_type': 'line_note'}"/>
                                    </control>

                                    <field name="sequence" widget="handle"/>
                                    <field name="display_type" invisible="1"/>
                                    <field name="product_uom_category_id" invisible="1"/>
                                    <field name="state" invisible="1" readonly="1"/>
                                    <field name="product_type" invisible="1"/>

                                    <field
                                            name="product_id"
                                            attrs="{
                                            'readonly': [('state', 'in', ('purchase', 'to approve','done', 'cancel'))],
                                            'required': [('display_type', '=', False)],
                                        }"
                                            context="{'partner_id':parent.partner_id, 'quantity':product_qty,'uom':product_uom, 'company_id': parent.company_id}"
                                            force_save="1"
                                            domain="[('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"/>

                                    <field name="name"/>
                                    <field name="date_planned" optional="hide"

                                           force_save="1"/>

                                    <field name="product_qty"/>

                                    <field name="product_uom" string="UoM" groups="uom.group_uom"
                                           attrs="{
                                            'readonly': [('state', 'in', ('confirme', 'expired', 'cancel'))],
                                            'required': [('display_type', '=', False)]
                                        }"
                                           force_save="1" optional="show"/>


                                </tree>
                            </field>
                        </page>


                    </notebook>

                    <group name="note_group" col="6" class="mt-2 mt-md-0">
                        <group colspan="4">
                            <field name="notes" nolabel="1" placeholder="Termes et Conditions d'Achat"/>
                        </group>

                        <div class="oe_clear"/>
                    </group>


                </sheet>

                 <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>

            </form>
        </field>
    </record>


    <record id="rfq_action" model="ir.actions.act_window">
        <field name="name">Demande de Prix</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.rfq</field>
        <field name="view_mode">tree,form</field>
        <!-- ,form,calendar,pivot,graph,activity -->
        <field name="view_id" ref="purchase_rfq_tree_view"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer une Demande de Prix !
            </p>
        </field>
    </record>
    <menuitem id="meu_purchase_rfq"
              name="Demande de Prix"
              action="rfq_action"
              parent="purchase.menu_purchase_root"
              sequence="5"/>

    <!-- Sequences for purchase.rfq -->
    <record id="seq_purchase_rfq" model="ir.sequence">
        <field name="name">RFQ</field>
        <field name="code">purchase.rfq</field>
        <field name="prefix">Demande de Prix - %(y)s -</field>
        <field name="padding">3</field>
        <field name="company_id" eval="False"/>
        <field name="use_date_range" eval="True"/>
    </record>


</odoo>